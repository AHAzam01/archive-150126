<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The 15/01 Archive</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;1,400&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background: radial-gradient(circle at center, #1a1025 0%, #050308 100%); color: #fff; height: 100vh; overflow: hidden; margin: 0; }
        .serif { font-family: 'Playfair Display', serif; }
        #bgVideoLoop { position: fixed; inset: 0; width: 100%; height: 100%; object-fit: cover; z-index: -1; opacity: 0; transition: opacity 1.2s ease-in-out; }
        #bgImage { position: fixed; inset: 0; width: 100%; height: 100%; object-fit: cover; z-index: -2; opacity: 0; transition: opacity 1.2s ease-in-out; }
        .full-screen { position: fixed; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; background: #050308; }
        .glass { background: rgba(15, 7, 25, 0.85); backdrop-filter: blur(25px); border: 1px solid rgba(139, 92, 246, 0.2); border-radius: 2rem; }
        .btn-action { padding: 1rem 2rem; border-radius: 99px; border: 1px solid rgba(255,255,255,0.15); text-transform: uppercase; font-size: 10px; letter-spacing: 3px; color: white; background: rgba(255,255,255,0.05); cursor: pointer; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .btn-action:hover { background: rgba(255,255,255,0.1); border-color: rgba(255,255,255,0.4); transform: translateY(-2px); }
        .btn-locked { opacity: 0.4; cursor: not-allowed; filter: grayscale(1); }
        #primo-display { position: fixed; top: 30px; left: 30px; z-index: 400; display: flex; align-items: center; gap: 8px; background: rgba(139, 92, 246, 0.15); padding: 10px 20px; border-radius: 99px; border: 1px solid rgba(139, 92, 246, 0.3); }
        #main-menu-btn { position: fixed; top: 30px; right: 30px; z-index: 400; cursor: pointer; display: none; }
        #side-menu { position: fixed; inset: 0; z-index: 500; background: rgba(5, 3, 8, 0.98); display: none; flex-direction: column; align-items: center; justify-content: center; gap: 1.5rem; }
    </style>
</head>
<body>

    <div id="primo-display" class="hidden">
        <span style="color: #a78bfa;">✦</span>
        <span id="primo-count" class="text-xs font-bold tracking-widest text-purple-200">0</span>
    </div>

    <div id="main-menu-btn" onclick="toggleMenu()">
        <div class="w-6 h-[1px] bg-purple-300/50 mb-1.5"></div>
        <div class="w-6 h-[1px] bg-purple-300/50"></div>
    </div>

    <div id="side-menu">
        <button onclick="toggleMenu()" class="absolute top-10 right-10 text-[10px] tracking-widest opacity-40">CLOSE</button>
        <p class="serif italic text-xl mb-6 opacity-30 tracking-[0.5em] text-purple-200">NAVIGASI ARSIP</p>
        <button onclick="jumpTo(1)" class="text-[10px] tracking-[0.4em] hover:text-purple-400 text-white/40 uppercase">00. The Map</button>
        <button onclick="jumpTo(2)" class="text-[10px] tracking-[0.4em] hover:text-purple-400 text-white/40 uppercase">01. Fragmen I</button>
        <button onclick="jumpTo(3)" class="text-[10px] tracking-[0.4em] hover:text-purple-400 text-white/40 uppercase">02. Fragmen II</button>
        <button onclick="jumpTo(4)" class="text-[10px] tracking-[0.4em] hover:text-purple-400 text-white/40 uppercase">03. Skyhill Archive</button>
    </div>

    <div id="intro-container">
        <div id="step-loading" class="full-screen">
            <p class="serif italic text-2xl tracking-[0.5em] animate-pulse mb-8 uppercase text-center px-6 text-purple-100">The 15/01 Archive</p>
            <button id="btn-open-arsip" class="btn-action">Buka Arsip</button>
        </div>

        <div id="video-modal" class="full-screen hidden">
            <div class="w-[85%] max-w-[380px] aspect-[9/16] bg-[#050308] rounded-[2rem] overflow-hidden border border-purple-500/20 shadow-2xl shadow-purple-900/20">
                <video id="introVideo" playsinline style="width:100%; height:100%; object-fit:cover;">
                    <source src="video-intro.mp4" type="video/mp4">
                </video>
            </div>
            <audio id="mainAudio" src="audio-final.mp3"></audio>
            <button id="btn-play-trigger" class="btn-action bg-white !text-black font-bold mt-10">Mulai Intro</button>
        </div>
    </div>

    <div id="app" class="hidden w-full h-full relative z-10 flex flex-col items-center px-6 pt-24 overflow-y-auto">
        <video id="bgVideoLoop" loop muted playsinline></video>
        <img id="bgImage" src="">

        <div id="card-map" class="glass p-10 w-full max-w-sm text-center space-y-6">
            <p class="text-[9px] opacity-40 uppercase tracking-widest">Archive Map</p>
            <div class="w-full aspect-square bg-white/5 rounded-xl overflow-hidden border border-purple-500/10">
                <img src="map.png" alt="Map" class="w-full h-full object-cover opacity-50">
            </div>
            <button onclick="displayFragment(2)" class="btn-action w-full">Mulai Fragmen I</button>
        </div>

        <div id="card-mission-1" class="glass p-10 w-full max-w-sm text-center space-y-6 hidden">
            <p class="text-[9px] opacity-40 uppercase tracking-widest">Fragmen I</p>
            <h3 class="serif text-2xl italic">"Jiwa-jiwa Liar"</h3>
            <p class="text-[10px] opacity-50 italic">Anjing raksasa berbulu abu-abu yang setia. Siapa namanya?</p>
            <input type="text" id="pass-1" placeholder="ENTER CODE" class="w-full bg-transparent border-b border-purple-500/30 py-3 text-center outline-none uppercase text-sm tracking-[0.3em]">
            <button onclick="verify(1, 'SADAHARU')" class="btn-action w-full">Verifikasi (+500 ✦)</button>
        </div>

        <div id="card-mission-2" class="glass p-10 w-full max-w-sm text-center space-y-6 hidden">
            <p class="text-[9px] opacity-40 uppercase tracking-widest">Fragmen II</p>
            <h3 class="serif text-2xl italic">"Penyucian Hening"</h3>
            <p class="text-[10px] opacity-50 italic">Kolam jernih bertingkat di dunia Teyvat?</p>
            <input type="text" id="pass-2" placeholder="L... P..." class="w-full bg-transparent border-b border-purple-500/30 py-3 text-center outline-none uppercase text-sm tracking-[0.3em]">
            <button onclick="verify(2, 'LUHUA POOL')" class="btn-action w-full">Verifikasi (+500 ✦)</button>
        </div>

        <div id="card-deep-talk" class="glass p-10 w-full max-w-sm text-center space-y-6 hidden">
            <p class="text-[9px] opacity-40 uppercase tracking-widest">Skyhill Archive</p>
            <p id="q-text" class="text-[11px] italic min-h-[60px] leading-relaxed text-purple-100">Apa momen paling tenang hari ini?</p>
            <div id="deep-talk-footer" class="space-y-4">
                <button id="btn-next-q" onclick="nextQuestion()" class="btn-action w-full">Lanjut</button>
                <div id="pay-hint" class="hidden text-center">
                    <button id="btn-pay-easter" onclick="unlockEaster()" class="btn-action w-full !bg-purple-600 !border-none font-bold">Unlock Memory (1000 ✦)</button>
                </div>
            </div>
        </div>

        <div id="card-easter-egg" class="glass p-10 w-full max-w-sm text-center space-y-6 hidden">
            <p class="text-[9px] text-purple-400 uppercase tracking-widest">The Aftermath Echo</p>
            <h3 class="serif text-2xl italic text-purple-100">"Sebuah Kenangan"</h3>
            <div class="space-y-4">
                <a href="video-easter-egg.mp4" download class="btn-action w-full !bg-purple-500 !text-white font-bold text-center block">Download Video</a>
                <a href="https://instagram.com/justanarchive2026" target="_blank" class="btn-action w-full !border-purple-400 !text-purple-400 text-center block">Visit Instagram</a>
            </div>
        </div>
    </div>

    <script>
        const introVideo = document.getElementById('introVideo');
        const mainAudio = document.getElementById('mainAudio');
        const bgVideo = document.getElementById('bgVideoLoop');
        const bgImg = document.getElementById('bgImage');
        
        let primo = 0;
        let currentFragment = 1; 
        let isUnlocked = false;
        let qIdx = 0;
        const qs = ["Apa momen paling tenang hari ini?", "Satu kata untuk perjalanan kita?", "Terima kasih sudah ada di sini."];

        // LOAD SAVE
        function loadState() {
            const saved = localStorage.getItem('archive_1501_v2');
            if (saved) {
                const data = JSON.parse(saved);
                primo = data.primo || 0;
                currentFragment = data.currentFragment || 1;
                isUnlocked = data.isUnlocked || false;
                return data.introWatched;
            }
            return false;
        }

        // SAVE STATE
        function save(intro = true) {
            localStorage.setItem('archive_1501_v2', JSON.stringify({
                primo, currentFragment, isUnlocked, introWatched: intro
            }));
            document.getElementById('primo-count').innerText = primo;
        }

        function addPrimo(amt) { primo += amt; save(); checkBtn(); }

        document.getElementById('btn-open-arsip').onclick = () => {
            document.getElementById('step-loading').classList.add('hidden');
            document.getElementById('video-modal').classList.remove('hidden');
        };

        document.getElementById('btn-play-trigger').onclick = function() {
            this.style.display = 'none';
            introVideo.play(); mainAudio.play();
            introVideo.onended = () => skipIntro();
        };

        function skipIntro() {
            document.getElementById('intro-container').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            document.getElementById('primo-display').classList.remove('hidden');
            document.getElementById('main-menu-btn').style.display = 'block';
            mainAudio.play(); mainAudio.volume = 0.5;
            save(); displayFragment(currentFragment);
        }

        function verify(id, code) {
            if (document.getElementById('pass-' + id).value.toUpperCase().trim() === code) {
                confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
                addPrimo(500);
                currentFragment = id + 2; 
                setTimeout(() => displayFragment(currentFragment), 1000);
            } else { alert('Kode Salah'); }
        }

        function displayFragment(f) {
            document.querySelectorAll('[id^="card-"]').forEach(el => el.classList.add('hidden'));
            const cards = ['card-map', 'card-mission-1', 'card-mission-2', 'card-deep-talk', 'card-easter-egg'];
            document.getElementById(cards[f-1]).classList.remove('hidden');
            
            if (f === 1) changeBg('image', 'map.png');
            else if (f === 2) changeBg('video', 'video-zoo.mp4');
            else if (f === 3) changeBg('video', 'video-spa.mp4');
            else changeBg('video', 'video-dinner.mp4');

            currentFragment = f; save(); checkBtn();
        }

        function changeBg(type, src) {
            bgVideo.style.opacity = 0; bgImg.style.opacity = 0;
            setTimeout(() => {
                if (type === 'video') {
                    bgVideo.src = src; bgVideo.play(); bgVideo.style.opacity = 0.5;
                } else {
                    bgImg.src = src; bgImg.style.opacity = 0.5;
                }
            }, 500);
        }

        function nextQuestion() {
            qIdx++;
            if (qIdx < qs.length) { 
                document.getElementById('q-text').innerText = qs[qIdx]; 
            } else {
                document.getElementById('btn-next-q').classList.add('hidden');
                document.getElementById('pay-hint').classList.remove('hidden');
            }
        }

        function checkBtn() {
            const btn = document.getElementById('btn-pay-easter');
            if (!btn) return;
            if (isUnlocked) {
                btn.innerText = "OPEN MEMORY";
                btn.onclick = () => displayFragment(5);
            } else if (primo >= 1000) {
                btn.classList.remove('btn-locked');
                btn.innerText = "Unlock Memory (1000 ✦)";
            } else {
                btn.classList.add('btn-locked');
                btn.innerText = `Need 1000 ✦ (${primo}/1000)`;
            }
        }

        function unlockEaster() {
            if (primo >= 1000) {
                if (!isUnlocked) primo -= 1000;
                isUnlocked = true; save();
                confetti({ particleCount: 200, spread: 100 });
                displayFragment(5);
            }
        }

        function toggleMenu() { const m = document.getElementById('side-menu'); m.style.display = (m.style.display === 'flex' ? 'none' : 'flex'); }
        function jumpTo(f) { displayFragment(f); toggleMenu(); }

        window.onload = () => {
            const watched = loadState();
            document.getElementById('primo-count').innerText = primo;
            if (watched) skipIntro();
        };
    </script>
</body>
</html>
